<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xiaoyuan.mapper.ErpPickgoodsMapper">


    <!--修改用。。。-->
    <update id="updateById">
        update tl_erp_pickgoods
        <set>
            <if test="pickgoods_man!=null and pickgoods_man!=''">
                pickgoods_man=#{pickgoods_man},
            </if>
            <if test="pickgoods_head!=null and pickgoods_head!=''">
                pickgoods_head=#{pickgoods_head},
            </if>
            <if test="pickgoods_date!=null and pickgoods_date!=''">
                pickgoods_date=#{pickgoods_date},
            </if>
            <if test="pickgoods_send_company!=null and pickgoods_send_company!=''">
                pickgoods_send_company=#{pickgoods_send_company},
            </if>
            <if test="pickgoods_num!=null">
                pickgoods_num=#{pickgoods_num},
            </if>
            <if test="ingoods_price!=null">
                ingoods_price=#{ingoods_price},
            </if>
            <if test="ingoods_totalprice!=null">
                ingoods_totalprice=#{ingoods_totalprice},
            </if>
            <if test="customer_name!=null and customer_name!=''">
                is_return_goods=#{is_return_goods},
            </if>
            <if test="pickgoods_car_sn!=null and pickgoods_car_sn!=''">
                pickgoods_car_sn=#{pickgoods_car_sn},
            </if>
            <if test="province_id!=null">
                province_id=#{province_id},
            </if>
            <if test="city_id!=null">
                city_id=#{city_id},
            </if>
            <if test="area_id!=null">
                area_id=#{area_id},
            </if>
            <if test="province_txt!=null and province_txt!=''">
                province_txt=#{province_txt},
            </if>
            <if test="city_txt!=null and city_txt!=''">
                city_txt=#{city_txt},
            </if>
            <if test="area_txt!=null and area_txt!=''">
                area_txt=#{area_txt},
            </if>
            <if test="user_address!=null and user_address!=''">
                user_address=#{user_address},
            </if>
            <if test="pickgoods_remark!=null and pickgoods_remark!=''">
                pickgoods_remark=#{pickgoods_remark},
            </if>

            <if test="status_!=null">
                status_=#{status_},
            </if>
            <if test="is_return_goods!=null">
                is_return_goods=#{is_return_goods},
            </if>
            <if test="is_car_order!=null">
                is_car_order=#{is_car_order},
            </if>
            <if test="is_confirm_queue!=null">
                is_confirm_queue=#{is_confirm_queue},
            </if>
            <if test="confirm_queue_datetime!=null and confirm_queue_datetime!=''">
                confirm_queue_datetime=#{confirm_queue_datetime},
            </if>
            <if test="pickgoods_car_sn!=null and pickgoods_car_sn!=''">
                pickgoods_car_sn=#{pickgoods_car_sn},
            </if>
            <if test="audit_man!=null and audit_man!=''">
                audit_man=#{audit_man},
            </if>
            <if test="audit_datetime!=null and audit_datetime!=''">
                audit_datetime=#{audit_datetime},
            </if>
        </set>
        where id=#{id}
    </update>

    <!--时间段应该是默认时分秒都为0，所以>=15号和<=15号，找不到符合的记录，除非时间为000，试了一下确实如此-->
    <select id="lists" resultType="com.xiaoyuan.model.ErpPickgoods">
        SELECT
        u2.user_name AS driver_name,
        u2.user_company_name AS driver_company,
        u.user_company_name as pickgoods_send_company,
        p.*,
        o.`car_order_money` AS pickgoods_send_price,
        po.*
        FROM
        tl_erp_pickgoods p
        LEFT JOIN tl_erp_pound po ON p.car_order_sn = po.pickgoods_id
        LEFT JOIN tl_erp_user u ON p.user_id = u.id
        LEFT JOIN tl_erp_user u2 ON u2.user_phone = p.driver_phone
        LEFT JOIN tl_erp_car_order o ON p.car_order_sn = o.car_order_sn
        WHERE
        1 = 1
        <if test="user_id==null">
            and order_cate = '销售'
        </if>
        <if test="user_id!=null">
            and p.user_id=#{user_id}
        </if>
        <if test="is_car_order!=null">
            and p.is_car_order=#{is_car_order}
        </if>
        <if test="is_end!=null">
            and p.is_end=#{is_end}
        </if>
        <if test="driver_phone!=null and driver_phone!=''">
            and p.driver_phone=#{driver_phone}
        </if>
        <if test="status_!=null">
            and p.status_=#{status_}
        </if>
        <if test="date1!=null and date1!=''">
            and p.pickgoods_date &gt;=#{date1}
        </if>
        <if test="date2!=null and date2!=''">
            and p.pickgoods_date &lt;=#{date2}
        </if>
        <if test="customer_name!=null and customer_name!=''">
            and p.customer_name LIKE concat( concat( '%', #{customer_name} ), '%' )
        </if>
        <if test="pickgoods_send_company!=null and pickgoods_send_company!=''">
            and u.`user_company_name` LIKE concat( concat( '%', #{pickgoods_send_company} ), '%' )
        </if>
        <if test="pickgoods_car_sn!=null and pickgoods_car_sn!=''">
            and p.pickgoods_car_sn LIKE concat( concat( '%', #{pickgoods_car_sn} ), '%' )
        </if>
        order by po.firstdate
    </select>
    <!--if test 按照筛选传参来判断排序列，-->

    <select id="maxOrderSn" resultType="com.xiaoyuan.model.ErpPickgoods">
		select max(o_id) from
		tl_erp_pickgoods
	</select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
INSERT INTO tl_erp_pickgoods (
driver_phone,
province_txt,
city_txt,
area_txt,
province_id,
city_id,
area_id,
customer_name,
id,
supplier_id,
pickgoods_num,
pickgoods_man,
pickgoods_head,
pickgoods_date,
pickgoods_sendcate,
pickgoods_send_company,
pickgoods_remark,
pickgoods_send_price,
pickgoods_car_sn,
createtime,
updatetime,
status_,
pickgoods_out,
goods_name,
goods_sn,
user_address,
supplier_spec,
car_order_sn,
user_id,
goods_spec,
ingoods_price,
ingoods_totalprice,
order_cate,
audit,
audittime
)
VALUES
		(#{driver_phone},#{province_txt},#{city_txt},#{area_txt},#{province_id},#{city_id},#{area_id},#{customer_name},#{id},#{supplier_id},#{pickgoods_num},#{pickgoods_man},#{pickgoods_head},#{pickgoods_date},#{pickgoods_sendcate},#{pickgoods_send_company},#{pickgoods_remark},#{pickgoods_send_price},
		#{pickgoods_car_sn},#{createtime},#{updatetime},#{status_},#{pickgoods_out},#{goods_name},#{goods_sn},#{user_address},#{supplier_spec},#{car_order_sn},#{user_id},#{goods_spec},#{ingoods_price},#{ingoods_totalprice},#{order_cate},#{audit},#{audittime})
	</insert>

    <select id="lists_statistice" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT p.id,
		p.`car_order_sn` AS
		car_order_sn,pickgoods_date,p.goods_name,pickgoods_num,u.`user_company_name`
		AS user_company_name,p.state,o.`car_order_price` AS
		car_order_price,o.`car_order_money` AS
		car_order_money,p.`user_address`,p.`pickgoods_car_sn`
		FROM
		tl_erp_pickgoods p,tl_erp_user u,tl_erp_car_order o
		WHERE p.`user_id` =
		u.id AND o.`car_order_sn` = p.car_order_sn
		and order_cate = '采购'
	</select>
    <select id="getByCarOrderSn" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT
		u.user_name AS
		user_name,
		p.pickgoods_date,
		p.goods_name,
		p.goods_sn,
		p.supplier_spec,
		p.user_address,
		p.pickgoods_send_company,
		p.pickgoods_remark,
		p.car_order_sn,
		p.pickgoods_car_sn,
		p.pickgoods_num,
		p.pickgoods_sendcate
		FROM
		tl_erp_pickgoods p,
		tl_erp_user u
		WHERE
		p.car_order_sn = #{car_order_sn}
		AND u.`id` = (SELECT d.user_id FROM
		tl_erp_driver d WHERE d.`car_sn`
		=#{pickgoods_car_sn});
	</select>
    <select id="out_goods" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT
		u.user_name AS
		user_name,
		p.goods_name,
		p.pickgoods_num,
		p.pickgoods_man,
		p.pickgoods_sendcate,
		p.goods_sn,
		p.supplier_spec,
		p.pickgoods_send_company,
		p.pickgoods_date,
		c.car_order_price AS
		car_order_price,
		p.pickgoods_car_sn,
		p.user_address,
		p.`car_order_sn`
		FROM
		tl_erp_pickgoods p,
		tl_erp_car_order c,
		tl_erp_user u
		WHERE
		p.`car_order_sn` = c.`car_order_sn`
		AND p.`car_order_sn` =
		#{car_order_sn}
		AND u.`id` = (SELECT d.user_id FROM tl_erp_driver d
		WHERE d.`car_sn`
		=#{pickgoods_car_sn});
	</select>

    <select id="get" resultType="com.xiaoyuan.model.ErpPickgoods">
		select *
		from tl_erp_pickgoods where id =#{id}
	</select>
    <!--出库单，is_end=1-->
    <select id="list_out_goods" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT
	po.grossweight,
	po.tare,
	po.netweight,
	po.squadron,
	po.remark,
	p.ingoods_price,
	p.ingoods_totalprice,
	c.id AS c_id,
	p.id,
	p.car_order_sn,
	p.pickgoods_date,
	p.pickgoods_car_sn,
	p.goods_name,
	p.goods_sn,
	p.supplier_spec,
	p.pickgoods_send_company,
	p.pickgoods_num,
	c.car_order_address AS user_address,
	u.user_company_name AS user_company_name,
	c.car_order_price
FROM
	tl_erp_pickgoods p,
	tl_erp_user u,
	tl_erp_car_order c,
	tl_erp_pound po
WHERE
	po.pickgoods_id = p.car_order_sn
	AND p.`user_id` = u.`id`
	AND c.`car_order_sn` = p.`car_order_sn`
	AND p.is_end =1
	</select>

    <select id="getPickgoodsByMessage" resultType="com.xiaoyuan.model.ErpPickgoods">
        SELECT p.`car_order_sn`,r.`car_load`,o.id as o_id FROM tl_erp_user u
        INNER JOIN tl_erp_driver dr ON dr.`user_id`=u.id
        INNER JOIN
        tl_erp_pickgoods p ON p.`user_id` IN
        (
        SELECT u.id FROM tl_erp_user u
        INNER JOIN tl_erp_pickgoods p ON u.id = p.user_id
        )
        INNER JOIN
        tl_erp_card c ON c.`driver_id` = dr.id
        INNER JOIN tl_erp_car
        r ON
        r.`driver_id` = dr.id
        INNER JOIN tl_erp_orders o ON
        o.`car_order_sn` =
        p.`car_order_sn`
        LEFT JOIN tl_erp_goods g ON
        g.goods_name = p.goods_name
        WHERE 1=1
        <if test="goods_name != null and goods_name != ''">
            and dr.car_sn=#{goods_name}
        </if>

        <if test="user_id != null">
            and u.id = #{user_id}
        </if>

        <if test="id != null">
            and g.id = #{id}
        </if>

        <if test="goods_sn != null and goods_sn != ''">
            and c.card_rfid = #{goods_sn}
        </if>

        <if test="car_order_money != 0.0">
            and p.`pickgoods_num` = #{car_order_money}
        </if>

        <if test="car_order_sn != null and car_order_sn != ''">
            and o.id=#{car_order_sn}
        </if>
        GROUP BY car_order_sn
    </select>
    <!-- //车牌号,客户id,存货id,RFID,重量 -->

    <select id="getPound" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT
		p.`car_order_sn`,p.pickgoods_num,p.`pickgoods_car_sn`,o.`queue_sn` AS
		queue_sn,d.`netweight` AS netweight,r.`car_load`,p.`goods_sn`,p.id
		FROM tl_erp_driver dr
		INNER JOIN tl_erp_user u ON dr.`user_id`=u.id
		INNER JOIN tl_erp_pickgoods p ON p.`pickgoods_car_sn` = dr.`car_sn`
		INNER JOIN tl_erp_card c ON c.`driver_id` = dr.id
		INNER JOIN tl_erp_car
		r ON r.`driver_id` = dr.id

		INNER JOIN tl_erp_car_order o ON
		o.car_order_sn = p.car_order_sn
		INNER JOIN tl_erp_orders s ON
		s.`car_order_sn` = p.`car_order_sn`
		INNER JOIN tl_erp_pound d ON
		d.pickgoods_id = s.id
		WHERE 1=1
		and dr.car_sn=#{goods_name}
		and
		c.card_rfid = #{goods_sn}

	</select>


    <select id="lists_audit" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT
		i.id,i.car_order_sn,i.`goods_sn`,s.`supplier_name` AS
		supplier_name,i.`pickgoods_car_sn`,i.`createtime` FROM
		tl_erp_pickgoods i,tl_erp_supplier s
		WHERE s.id = i.`supplier_id`
		AND
		i.audit =0
		and order_cate = '采购'
	</select>

    <select id="getPriceByMessage" resultType="com.xiaoyuan.model.ErpPickgoods">
		select ingoods_price
		from tl_erp_pickgoods i where
		i.supplier_id=#{supplier_id}
		and
		i.goods_name = #{goods_name}
		and order_cate = '采购'
	</select>

    <!-- 这里postman后报错，提示没有id，只有supplier_id，遂将#{id}改为以下 -->
    <!-- 修改查询的内容 -->
    <select id="lists_price" resultType="com.xiaoyuan.model.ErpPickgoods">
        <!-- SELECT i.id, i.`pickgoods_send_company` AS company_name, i.goods_sn,i.goods_name,i.`ingoods_price`,i.supplier_id
            as supplier_id FROM tl_erp_pickgoods i,tl_erp_supplier s,tl_erp_user u -->
        SELECT
        i.*,
        i.id,
        i.`pickgoods_send_company` AS company_name,
        i.goods_sn,
        i.goods_name,
        i.`ingoods_price`,
        i.supplier_id AS supplier_id
        FROM
        tl_erp_pickgoods i,
        tl_erp_supplier s,
        tl_erp_user u
        WHERE
        i.`supplier_id` = s.id AND u.id = s.`user_id`
        AND i.status_=0
        and
        order_cate = '采购'
        <if test="supplier_id != null">
            <!-- and s.`user_id` = #{id} -->
            and supplier_id = #{supplier_id}
        </if>
    </select>

    <!-- YZH 供应商确认价格之后园区审核， ，没有数据 -->
    <!-- 供应商查所有，audit=0，园区查只有车牌号的，没有车牌号要录入 -->
    <select id="lists_ingoods" resultType="com.xiaoyuan.model.ErpPickgoods">
        SELECT i.id,supplier_id,u.`user_company_name` AS
        company_name,s.`goods_name` AS goods_name,s.goods_sn AS
        goods_sn,s.`supplier_name` AS
        supplier_name,i.`ingoods_price`,pickgoods_num,pickgoods_man,pickgoods_sendcate,ingoods_totalprice,pickgoods_send_company
        FROM tl_erp_pickgoods i,tl_erp_supplier s,tl_erp_user u
        WHERE
        i.`supplier_id` = s.id
        AND u.id = s.user_id
        AND i.pickgoods_sendcate=2
        AND i.status_=1
        AND
        i.audit=0
        <if test="pickgoods_car_sn != null and pickgoods_car_sn != ''">
            and i.pickgoods_car_sn IS NOT NULL
        </if>
        and order_cate = '采购'
        order by i.createtime DESC
    </select>


    <select id="lists_statistical" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT
		i.id,
		i.goods_name,
		i.`pickgoods_sendcate`,
		i.`car_order_sn`,
		pickgoods_num,
		pickgoods_man,
		i.`goods_spec`,
		i.`goods_sn`,
		s.`supplier_name` AS
		supplier_name,
		ingoods_price,
		pickgoods_car_sn,
		i.createtime
		FROM
		tl_erp_supplier s,
		tl_erp_pickgoods i
		WHERE i.`supplier_id` = s.id
		AND
		i.`order_cate`='采购'
		order by i.createtime desc
	</select>


    <select id="in_warehouse" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT
		i.pickgoods_car_sn,
		i.car_order_sn,
		i.pickgoods_send_company,
		i.goods_name,
		i.goods_sn,
		i.goods_spec ,
		i.pickgoods_remark,
		u.user_name AS user_name,
		s.supplier_name AS supplier_name
		FROM tl_erp_pickgoods
		i,tl_erp_supplier s,tl_erp_user u
		WHERE i.`car_order_sn`
		=#{car_order_sn}
		AND i.`supplier_id` = s.id
		AND u.`id` = (SELECT
		d.user_id FROM tl_erp_driver d WHERE d.`car_sn`
		=#{pickgoods_car_sn})
		AND i.`order_cate`='采购'
	</select>

    <select id="purchase" resultType="com.xiaoyuan.model.ErpPickgoods">
		SELECT
		i.pickgoods_car_sn,
		i.car_order_sn,
		i.goods_name,
		i.goods_sn,
		i.goods_spec,
		i.`pickgoods_remark`,
		i.`createtime`,
		i.`pickgoods_num`,
		i.`pickgoods_man`,
		i.`pickgoods_sendcate`,
		u.user_name AS user_name,
		u.`user_company_name` AS company_name,
		u.`company_address` AS
		company_address
		FROM tl_erp_pickgoods i,tl_erp_supplier s,tl_erp_user u
		WHERE i.`car_order_sn` =#{car_order_sn}
		AND i.`supplier_id` = s.id
		AND
		u.`id` = (SELECT d.user_id FROM tl_erp_driver d WHERE d.`car_sn`
		=#{pickgoods_car_sn})
		AND i.`order_cate`='采购'
	</select>
    <select id="countBySearch" resultType="java.lang.Integer">
        SELECT count(PICKGOODS.id)
        FROM
        tl_erp_pickgoods                AS PICKGOODS
        LEFT JOIN tl_erp_driver			AS DRIVER ON DRIVER.id = PICKGOODS.driver_id
        LEFT JOIN tl_erp_user           AS DRIVER_USER  ON DRIVER_USER.id = DRIVER.user_id
        LEFT JOIN tl_erp_terminal_customer AS CUSTOMER ON PICKGOODS.customer_id = CUSTOMER.id
        LEFT JOIN tl_erp_pound          AS POUND ON POUND.pickgoods_id = PICKGOODS.car_order_sn

        WHERE 1=1
        <if test="phone !=null and phone!=''">
            AND DRIVER_USER.user_phone = #{phone}
        </if>
        <if test="userId !=null and userId>0">
            AND PICKGOODS.user_id = #{userId}
        </if>
        <if test="orderId !=null">
            AND PICKGOODS.id = #{orderId}
        </if>
        <if test="status !=null">
            <if test="status == 1">
                AND POUND.netweight is not null and PICKGOODS.order_status =0
            </if>
            <if test="status == 0">
                AND POUND.netweight is null and PICKGOODS.order_status =0
            </if>
            <if test="status == -1">
                AND PICKGOODS.order_status = -1
            </if>
        </if>

        <if test="orderCate!=null">
            <if test="orderCate == 1 ">
                and PICKGOODS.order_cate = '销售'
                <if test="startTime!=null and startTime!=''">
                    and PICKGOODS.pickgoods_date &gt;=#{startTime}
                </if>
                <if test="endTime!=null and endTime!=''">
                    and PICKGOODS.pickgoods_date &lt;=CONCAT(#{endTime}, ' 23:59:59')
                </if>
            </if>
            <if test="orderCate == -1 ">
                and PICKGOODS.order_cate = '采购'
                <if test="startTime!=null and startTime!=''">
                    and POUND.seconddate &gt;=#{startTime}
                </if>
                <if test="endTime!=null and endTime!=''">
                    and POUND.seconddate &lt;=CONCAT(#{endTime}, ' 23:59:59')
                </if>
                <if test="orderErr!=null">
                    <if test="orderErr==1">
                        AND POUND.netweight &lt; 5000.00
                    </if>
                    <if test="orderErr==0">
                        AND POUND.netweight &gt;= 5000.00
                    </if>
                </if>
            </if>
        </if>
        <if test="orderSn!=null and orderSn !=''">
            AND PICKGOODS.car_order_sn  = #{orderSn}
        </if>
        <if test="null!=customerId and customerId>0">
            AND PICKGOODS.customer_id = #{customerId}
        </if>
        <if test="null!=driverId and driverId>0">
            AND PICKGOODS.driver_id = #{driverId}
        </if>
        <if test="null!=search and search != ''">
            AND ( PICKGOODS.goods_name LIKE concat( concat( '%', #{search} ),'%'))
        </if>
        <if test="null!=goodsName and goodsName !=''">
            AND PICKGOODS.goods_name = #{goodsName}
        </if>

        <if test="null!=searchs">
            AND
            <foreach close=")" collection="searchs" item="listItem" open="(" separator="OR">
                PICKGOODS.goods_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR DRIVER_USER.user_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR DRIVER_USER.user_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR PICKGOODS.pickgoods_car_sn LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.customer_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.customer_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.terminal_customer_address LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_description LIKE concat( concat( '%', #{listItem} ),'%')
            </foreach>
        </if>
        <if test="null!=expireTime">
            and PICKGOODS.pickgoods_date &lt;= #{expireTime} and PICKGOODS.is_confirm_queue &lt;&gt; 1
        </if>
        <if test="null!=orderBy and orderBy != ''">
            order by ${orderBy}
            <if test="isDesc == 1">
                DESC
            </if>
        </if>
    </select>
    <select id="selectOrderBySearch" resultType="com.xiaoyuan.model.dto.ErpPickgoodsDto">
        SELECT
        POUND.grossweight,POUND.tare,POUND.netweight,POUND.price as deduct_price,
        round(POUND.grossweight/1000,3) as grossweightUnit,
        round(POUND.tare / 1000,3) as tareUnit,
        round(POUND.netweight / 1000,3)  as netweightUnit,
        DATE_FORMAT( POUND.firstdate, "%Y-%m-%d %H:%i:%s" ) as firstdate,
        DATE_FORMAT( POUND.seconddate, "%Y-%m-%d %H:%i:%s" ) as seconddate,POUND.squadron,POUND.remark,
        DATE_FORMAT( PICKGOODS.pickgoods_date, "%Y-%m-%d" ) AS sendTime,
        DRIVER_USER.user_name AS driver_name,
        DRIVER_USER.real_name AS driver_real_name,
        DRIVER_USER.user_company_name AS driver_company,
        SEND_USER.user_phone AS send_phone,
        (CASE WHEN PICKGOODS.order_cate = '销售'  THEN CUSTOMER.customer_company_name
        WHEN PICKGOODS.order_cate = '采购'  THEN GOODS.supplier_name ELSE '订单类型错误' END) AS customer_company_name,
        CUSTOMER.customer_company_sn,
        CUSTOMER.customer_sn,CUSTOMER.coordinate,
        SEND_USER.user_company_name    AS user_company_name,
        SEND_USER.real_name AS real_name,
        PICKGOODS.*,PICKGOODS.createtime AS createTimeTxt,
        (CASE when POUND.netweight is not null and PICKGOODS.order_status =0 then "已完成"
        when  POUND.netweight is null and PICKGOODS.order_status &lt;&gt; -1  then "未完成"
        when PICKGOODS.order_status = -1 then "取消" else "未完成" END) AS orderStatusTxt
        FROM
        tl_erp_pickgoods                AS PICKGOODS
        LEFT JOIN tl_erp_user
           AS SEND_USER  ON PICKGOODS.user_id = SEND_USER.id
        LEFT JOIN tl_erp_driver			AS DRIVER ON DRIVER.id = PICKGOODS.driver_id
        LEFT JOIN tl_erp_user           AS DRIVER_USER  ON DRIVER_USER.id = DRIVER.user_id
        LEFT JOIN tl_erp_terminal_customer AS CUSTOMER ON PICKGOODS.customer_id = CUSTOMER.id
        LEFT JOIN tl_erp_pound          AS POUND ON POUND.pickgoods_id = PICKGOODS.car_order_sn
        LEFT JOIN tl_erp_goods          AS GOODS ON GOODS.goods_sn = PICKGOODS.goods_sn
        WHERE 1=1
        <if test="phone !=null and phone!=''">
            AND DRIVER_USER.user_phone = #{phone}
        </if>
        <if test="userId !=null and userId>0">
            AND PICKGOODS.user_id = #{userId}
        </if>
        <if test="orderId !=null">
            AND PICKGOODS.id = #{orderId}
        </if>
        <if test="status !=null">
            <if test="status == 1">
                AND POUND.netweight is not null and PICKGOODS.order_status =0
            </if>
            <if test="status == 0">
                AND POUND.netweight is null and PICKGOODS.order_status =0
            </if>
            <if test="status == -1">
                AND PICKGOODS.order_status = -1
            </if>
        </if>
        <if test="orderCate!=null">
            <if test="orderCate == 1 ">
                and PICKGOODS.order_cate = '销售'
                <if test="startTime!=null and startTime!=''">
                    and PICKGOODS.pickgoods_date &gt;=#{startTime}
                </if>
                <if test="endTime!=null and endTime!=''">
                    and PICKGOODS.pickgoods_date &lt;=CONCAT(#{endTime}, ' 23:59:59')
                </if>
            </if>
            <if test="orderCate == -1 ">
                and PICKGOODS.order_cate = '采购'
                <if test="startTime!=null and startTime!=''">
                    and POUND.seconddate &gt;=#{startTime}
                </if>
                <if test="endTime!=null and endTime!=''">
                    and POUND.seconddate &lt;=CONCAT(#{endTime}, ' 23:59:59')
                </if>
                <if test="orderErr!=null">
                    <if test="orderErr==1">
                    AND POUND.netweight &lt; 5000.00
                    </if>
                    <if test="orderErr==0">
                        AND POUND.netweight &gt;= 5000.00
                    </if>
                </if>
            </if>
        </if>
        <if test="orderSn!=null and orderSn !=''">
            AND PICKGOODS.car_order_sn  = #{orderSn}
        </if>
        <if test="null!=customerId and customerId>0">
            AND PICKGOODS.customer_id = #{customerId}
        </if>
        <if test="null!=driverId and driverId>0">
            AND PICKGOODS.driver_id = #{driverId}
        </if>
        <if test="null!=search and search != ''">
            AND ( PICKGOODS.goods_name LIKE concat( concat( '%', #{search} ),'%'))
        </if>
        <if test="null!=goodsName and goodsName !=''">
            AND PICKGOODS.goods_name = #{goodsName}
        </if>
        <if test="null!=searchs">
            AND
            <foreach close=")" collection="searchs" item="listItem" open="(" separator="OR">
                PICKGOODS.goods_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR DRIVER_USER.user_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR DRIVER_USER.user_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR PICKGOODS.pickgoods_car_sn LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.customer_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.customer_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.terminal_customer_address LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_description LIKE concat( concat( '%', #{listItem} ),'%')
            </foreach>
        </if>
        <if test="null!=expireTime">
            and PICKGOODS.pickgoods_date &lt;= #{expireTime} and PICKGOODS.is_confirm_queue &lt;&gt; 1
        </if>
        <if test="null!=orderBy and orderBy != ''">
            order by ${orderBy}
            <if test="isDesc == 1">
                DESC
            </if>
            ,PICKGOODS.createtime DESC
        </if>
    </select>
    <select id="countOrderAmount" resultType="com.xiaoyuan.model.dto.ErpOrderAmountDto">
        SELECT
        IFNULL(SUM(CASE WHEN POUND.netweight is not null and PICKGOODS.order_status =0 THEN 1 ELSE 0 END),0) AS overNum,
        IFNULL(SUM(CASE WHEN POUND.netweight is null and PICKGOODS.order_status =0 THEN 1 ELSE 0 END),0) AS actionNum,
        IFNULL(SUM(CASE WHEN PICKGOODS.order_status = -1  THEN 1 ELSE 0 END),0) AS cannelNum,
        round(IFNULL(SUM(CASE WHEN POUND.netweight is not null and PICKGOODS.order_status =0  THEN POUND.netweight ELSE 0 END),0)/1000,3) as totalNum,
        IFNULL(SUM(CASE WHEN POUND.netweight is not null and PICKGOODS.order_status =0  THEN POUND.deduct_price ELSE 0 END),0) as sellPrice
        FROM
        tl_erp_pickgoods                AS PICKGOODS
        LEFT JOIN tl_erp_user           AS SEND_USER    ON PICKGOODS.user_id = SEND_USER.id
        LEFT JOIN tl_erp_driver			AS DRIVER ON DRIVER.id = PICKGOODS.driver_id
        LEFT JOIN tl_erp_user           AS DRIVER_USER  ON DRIVER_USER.id = DRIVER.user_id
        LEFT JOIN tl_erp_terminal_customer AS CUSTOMER ON PICKGOODS.customer_id = CUSTOMER.id
        LEFT JOIN tl_erp_pound          AS POUND ON POUND.pickgoods_id = PICKGOODS.car_order_sn
        WHERE 1=1
        <if test="phone !=null and phone!=''">
            AND DRIVER_USER.user_phone = #{phone}
        </if>
        <if test="userId !=null and userId>0">
            AND PICKGOODS.user_id = #{userId}
        </if>
        <if test="customerId !=null and customerId>0">
            AND PICKGOODS.customer_id = #{customerId}
        </if>
        <if test="orderCate!=null">
            <if test="orderCate == 1 ">
                and PICKGOODS.order_cate = '销售'
                <if test="startTime!=null and startTime!=''">
                    and PICKGOODS.pickgoods_date &gt;=#{startTime}
                </if>
                <if test="endTime!=null and endTime!=''">
                    and PICKGOODS.pickgoods_date &lt;=CONCAT(#{endTime}, ' 23:59:59')
                </if>
            </if>
            <if test="orderCate == -1 ">
                and PICKGOODS.order_cate = '采购'
                <if test="startTime!=null and startTime!=''">
                    and POUND.seconddate &gt;=#{startTime}
                </if>
                <if test="endTime!=null and endTime!=''">
                    and POUND.seconddate &lt;=CONCAT(#{endTime}, ' 23:59:59')
                </if>
                <if test="orderErr!=null">
                    <if test="orderErr==1">
                        AND POUND.netweight &lt; 5000.00
                    </if>
                    <if test="orderErr==0">
                        AND POUND.netweight &gt;= 5000.00
                    </if>
                </if>
            </if>
        </if>
        <if test="null!=search and search != ''">
            AND ( PICKGOODS.goods_name LIKE concat( concat( '%', #{search} ),'%'))
        </if>
        <if test="null!=goodsName and goodsName !=''">
            AND PICKGOODS.goods_name = #{goodsName}
        </if>
        <if test="null!=driverId and driverId>0">
            AND PICKGOODS.driver_id = #{driverId}
        </if>
        <if test="null!=searchs">
            AND
            <foreach close=")" collection="searchs" item="listItem" open="(" separator="OR">
                PICKGOODS.goods_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR DRIVER_USER.user_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR DRIVER_USER.user_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR PICKGOODS.pickgoods_car_sn LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.customer_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.customer_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.terminal_customer_address LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_description LIKE concat( concat( '%', #{listItem} ),'%')
            </foreach>
        </if>
    </select>
    <select id="countPickgoodsAccountTotal" resultType="com.xiaoyuan.model.dto.ErpPickgoodsTotalDto">
        SELECT
        IFNULL(SUM(CASE WHEN POUND.netweight is not NULL and PICKGOODS.order_status =0 THEN 1 ELSE 0 END),0) AS overOrderNum,
        round(IFNULL(SUM(CASE WHEN POUND.netweight is not NULL and PICKGOODS.order_status =0 THEN POUND.netweight ELSE 0 END),0.00)/1000,3) AS pickGoodsNum,
        IFNULL(SUM(CASE WHEN POUND.netweight is not NULL and PICKGOODS.order_status =0 THEN POUND.deduct_price ELSE 0 END),0.00) AS consumeAmountMoney
        FROM tl_erp_pickgoods AS PICKGOODS
        LEFT JOIN tl_erp_user           AS SEND_USER    ON PICKGOODS.user_id = SEND_USER.id
        LEFT JOIN tl_erp_driver			AS DRIVER ON DRIVER.id = PICKGOODS.driver_id
        LEFT JOIN tl_erp_user           AS DRIVER_USER  ON DRIVER_USER.id = DRIVER.user_id
        LEFT JOIN tl_erp_terminal_customer AS CUSTOMER ON PICKGOODS.customer_id = CUSTOMER.id
        LEFT JOIN tl_erp_pound          AS POUND ON POUND.pickgoods_id = PICKGOODS.car_order_sn
        WHERE 1=1
        <if test="null!=userId and userId>0">
            AND PICKGOODS.user_id = #{userId}
        </if>
        <if test="null!=customerId and customerId>0">
            AND PICKGOODS.customer_id = #{customerId}
        </if>
        <if test="status !=null">
            <if test="status == 1">
                AND POUND.netweight is not null and PICKGOODS.order_status &lt;&gt; -1
            </if>
            <if test="status == 0">
                AND POUND.netweight is null and PICKGOODS.order_status &lt;&gt; -1
            </if>
            <if test="status == -1">
                AND PICKGOODS.order_status = -1
            </if>
        </if>
        <if test="orderCate!=null">
            <if test="orderCate == 1 ">
                and PICKGOODS.order_cate = '销售'
                <if test="startTime!=null and startTime!=''">
                    and PICKGOODS.pickgoods_date &gt;=#{startTime}
                </if>
                <if test="endTime!=null and endTime!=''">
                    and PICKGOODS.pickgoods_date &lt;=CONCAT(#{endTime}, ' 23:59:59')
                </if>
            </if>
            <if test="orderCate == -1 ">
                and PICKGOODS.order_cate = '采购'
                <if test="startTime!=null and startTime!=''">
                    and POUND.seconddate &gt;=#{startTime}
                </if>
                <if test="endTime!=null and endTime!=''">
                    and POUND.seconddate &lt;=CONCAT(#{endTime}, ' 23:59:59')
                </if>
                <if test="orderErr!=null">
                    <if test="orderErr==1">
                        AND POUND.netweight &lt; 5000.00
                    </if>
                    <if test="orderErr==0">
                        AND POUND.netweight &gt;= 5000.00
                    </if>
                </if>
            </if>
        </if>
        <if test="null!=search and search != ''">
            AND ( PICKGOODS.goods_name LIKE concat( concat( '%', #{search} ),'%'))
        </if>
        <if test="null!=goodsName and goodsName !=''">
            AND PICKGOODS.goods_name = #{goodsName}
        </if>
        <if test="null!=searchs">
            AND
            <foreach close=")" collection="searchs" item="listItem" open="(" separator="OR">
                PICKGOODS.goods_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR DRIVER_USER.user_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR DRIVER_USER.user_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR PICKGOODS.pickgoods_car_sn LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.customer_company_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.customer_name LIKE concat( concat( '%', #{listItem} ),'%')
                OR CUSTOMER.terminal_customer_address LIKE concat( concat( '%', #{listItem} ),'%')
                OR SEND_USER.user_description LIKE concat( concat( '%', #{listItem} ),'%')
            </foreach>
        </if>
    </select>

    <update id="updateByPickGoods">
        update tl_erp_pickgoods
        <set>
            <if test="user_id != null">
                user_id= #{user_id,jdbcType=INTEGER},
            </if>
            <if test="supplier_id != null">
                supplier_id = #{supplier_id,jdbcType=INTEGER},
            </if>
            <if test="car_order_sn != null">
                car_order_sn= #{car_order_sn,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_out != null">
                pickgoods_out =  #{pickgoods_out,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_num != null">
                pickgoods_num = #{pickgoods_num,jdbcType=DECIMAL},
            </if>
            <if test="pickgoods_man != null">
                pickgoods_man = #{pickgoods_man,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_date != null">
                pickgoods_date=  #{pickgoods_date,jdbcType=TIMESTAMP},
            </if>
            <if test="pickgoods_head != null">
                pickgoods_head = #{pickgoods_head,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_car_sn != null">
                pickgoods_car_sn= #{pickgoods_car_sn,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_remark != null">
                pickgoods_remark= #{pickgoods_remark,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_sendcate != null">
                pickgoods_sendcate=  #{pickgoods_sendcate,jdbcType=INTEGER},
            </if>
            <if test="pickgoods_send_price != null">
                pickgoods_send_price=   #{pickgoods_send_price,jdbcType=DECIMAL},
            </if>
            <if test="pickgoods_send_company != null">
                pickgoods_send_company=  #{pickgoods_send_company,jdbcType=VARCHAR},
            </if>
            <if test="createtime != null">
                createtime=#{createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="updatetime != null">
                updatetime=#{updatetime,jdbcType=TIMESTAMP},
            </if>
            <if test="state != null">
                state=#{state,jdbcType=INTEGER},
            </if>
            <if test="status_ != null">
                status_= #{status_,jdbcType=INTEGER},
            </if>
            <if test="goods_sn != null">
                goods_sn=#{goods_sn,jdbcType=VARCHAR},
            </if>
            <if test="goods_cate != null">
                goods_cate= #{goods_cate,jdbcType=VARCHAR},
            </if>
            <if test="goods_spec != null">
                goods_spec=#{goods_spec,jdbcType=VARCHAR},
            </if>
            <if test="goods_name != null">
                goods_name=#{goods_name,jdbcType=VARCHAR},
            </if>
            <if test="audit != null">
                audit=#{audit,jdbcType=INTEGER},
            </if>
            <if test="audittime != null">
                audittime=#{audittime,jdbcType=TIMESTAMP},
            </if>
            <if test="order_cate != null">
                order_cate= #{order_cate,jdbcType=VARCHAR},
            </if>
            <if test="user_address != null">
                user_address=#{user_address,jdbcType=VARCHAR},
            </if>
            <if test="supplier_spec != null">
                supplier_spec= #{supplier_spec,jdbcType=VARCHAR},
            </if>
            <if test="ingoods_price != null">
                ingoods_price= #{ingoods_price,jdbcType=DECIMAL},
            </if>
            <if test="ingoods_totalprice != null">
                ingoods_totalprice=#{ingoods_totalprice,jdbcType=DECIMAL},
            </if>
            <if test="is_car_order != null">
                is_car_order=#{is_car_order,jdbcType=INTEGER},
            </if>
            <if test="is_return_goods != null">
                is_return_goods=#{is_return_goods,jdbcType=INTEGER},
            </if>
            <if test="is_confirm_queue != null">
                is_confirm_queue= #{is_confirm_queue,jdbcType=INTEGER},
            </if>
            <if test="confirm_queue_device != null">
                confirm_queue_device= #{confirm_queue_device,jdbcType=INTEGER},
            </if>
            <if test="confirm_queue_datetime != null">
                confirm_queue_datetime=  #{confirm_queue_datetime,jdbcType=TIMESTAMP},
            </if>
            <if test="province_id != null">
                province_id=#{province_id,jdbcType=INTEGER},
            </if>
            <if test="area_id != null">
                area_id=#{area_id,jdbcType=INTEGER},
            </if>
            <if test="city_id != null">
                city_id= #{city_id,jdbcType=INTEGER},
            </if>
            <if test="province_txt != null">
                province_txt= #{province_txt,jdbcType=VARCHAR},
            </if>
            <if test="city_txt != null">
                city_txt= #{city_txt,jdbcType=VARCHAR},
            </if>
            <if test="area_txt != null">
                area_txt=#{area_txt,jdbcType=VARCHAR},
            </if>
            <if test="customer_name != null">
                customer_name=#{customer_name,jdbcType=VARCHAR},
            </if>
            <if test="audit_man != null">
                audit_man=#{audit_man,jdbcType=VARCHAR},
            </if>
            <if test="audit_datetime != null">
                audit_datetime=#{audit_datetime,jdbcType=TIMESTAMP},
            </if>
            <if test="is_end != null">
                is_end=#{is_end,jdbcType=INTEGER},
            </if>
            <if test="driver_phone != null">
                driver_phone=#{driver_phone,jdbcType=VARCHAR},
            </if>
            <if test="driver_id != null">
                driver_id=#{driver_id,jdbcType=VARCHAR},
            </if>

            <if test="customer_id != null">
                customer_id=#{customer_id,jdbcType=INTEGER},
            </if>
            <if test="order_status != null">
                order_status=#{order_status,jdbcType=INTEGER},
            </if>
            <if test="in_customer_time != null">
                in_customer_time =  #{in_customer_time},
            </if>
        </set>
        WHERE id = #{id}
    </update>
    <update id="updateByIds">
        update tl_erp_pickgoods
        <set>
            <if test="order.user_id != null">
                user_id= #{order.user_id,jdbcType=INTEGER},
            </if>
            <if test="order.supplier_id != null">
                supplier_id = #{order.supplier_id,jdbcType=INTEGER},
            </if>
            <if test="order.car_order_sn != null">
                car_order_sn= #{order.car_order_sn,jdbcType=VARCHAR},
            </if>
            <if test="order.pickgoods_out != null">
                pickgoods_out =  #{order.pickgoods_out,jdbcType=VARCHAR},
            </if>
            <if test="order.pickgoods_num != null">
                pickgoods_num = #{order.pickgoods_num,jdbcType=DECIMAL},
            </if>
            <if test="order.pickgoods_man != null">
                pickgoods_man = #{order.pickgoods_man,jdbcType=VARCHAR},
            </if>
            <if test="order.pickgoods_date != null">
                pickgoods_date=  #{order.pickgoods_date,jdbcType=TIMESTAMP},
            </if>
            <if test="order.pickgoods_head != null">
                pickgoods_head = #{order.pickgoods_head,jdbcType=VARCHAR},
            </if>
            <if test="order.pickgoods_car_sn != null">
                pickgoods_car_sn= #{order.pickgoods_car_sn,jdbcType=VARCHAR},
            </if>
            <if test="order.pickgoods_remark != null">
                pickgoods_remark= #{order.pickgoods_remark,jdbcType=VARCHAR},
            </if>
            <if test="order.pickgoods_sendcate != null">
                pickgoods_sendcate=  #{order.pickgoods_sendcate,jdbcType=INTEGER},
            </if>
            <if test="order.pickgoods_send_price != null">
                pickgoods_send_price=   #{order.pickgoods_send_price,jdbcType=DECIMAL},
            </if>
            <if test="order.pickgoods_send_company != null">
                pickgoods_send_company=  #{order.pickgoods_send_company,jdbcType=VARCHAR},
            </if>
            <if test="order.createtime != null">
                createtime=#{order.createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="order.updatetime != null">
                updatetime=#{order.updatetime,jdbcType=TIMESTAMP},
            </if>
            <if test="order.state != null">
                state=#{order.state,jdbcType=INTEGER},
            </if>
            <if test="order.status_ != null">
                status_= #{order.status_,jdbcType=INTEGER},
            </if>
            <if test="order.goods_sn != null">
                goods_sn=#{order.goods_sn,jdbcType=VARCHAR},
            </if>
            <if test="order.goods_cate != null">
                goods_cate= #{order.goods_cate,jdbcType=VARCHAR},
            </if>
            <if test="order.goods_spec != null">
                goods_spec=#{order.goods_spec,jdbcType=VARCHAR},
            </if>
            <if test="order.goods_name != null">
                goods_name=#{order.goods_name,jdbcType=VARCHAR},
            </if>
            <if test="order.audit != null">
                audit=#{order.audit,jdbcType=INTEGER},
            </if>
            <if test="order.audittime != null">
                audittime=#{order.audittime,jdbcType=TIMESTAMP},
            </if>
            <if test="order.order_cate != null">
                order_cate= #{order.order_cate,jdbcType=VARCHAR},
            </if>
            <if test="order.user_address != null">
                user_address=#{order.user_address,jdbcType=VARCHAR},
            </if>
            <if test="order.supplier_spec != null">
                supplier_spec= #{order.supplier_spec,jdbcType=VARCHAR},
            </if>
            <if test="order.ingoods_price != null">
                ingoods_price= #{order.ingoods_price,jdbcType=DECIMAL},
            </if>
            <if test="order.ingoods_totalprice != null">
                ingoods_totalprice=#{order.ingoods_totalprice,jdbcType=DECIMAL},
            </if>
            <if test="order.is_car_order != null">
                is_car_order=#{order.is_car_order,jdbcType=INTEGER},
            </if>
            <if test="order.is_return_goods != null">
                is_return_goods=#{order.is_return_goods,jdbcType=INTEGER},
            </if>
            <if test="order.is_confirm_queue != null">
                is_confirm_queue= #{order.is_confirm_queue,jdbcType=INTEGER},
            </if>
            <if test="order.confirm_queue_device != null">
                confirm_queue_device= #{order.confirm_queue_device,jdbcType=INTEGER},
            </if>
            <if test="order.confirm_queue_datetime != null">
                confirm_queue_datetime=  #{order.confirm_queue_datetime,jdbcType=TIMESTAMP},
            </if>
            <if test="order.province_id != null">
                province_id=#{order.province_id,jdbcType=INTEGER},
            </if>
            <if test="order.area_id != null">
                area_id=#{order.area_id,jdbcType=INTEGER},
            </if>
            <if test="order.city_id != null">
                city_id= #{order.city_id,jdbcType=INTEGER},
            </if>
            <if test="order.province_txt != null">
                province_txt= #{order.province_txt,jdbcType=VARCHAR},
            </if>
            <if test="order.city_txt != null">
                city_txt= #{order.city_txt,jdbcType=VARCHAR},
            </if>
            <if test="order.area_txt != null">
                area_txt=#{order.area_txt,jdbcType=VARCHAR},
            </if>
            <if test="order.customer_name != null">
                customer_name=#{order.customer_name,jdbcType=VARCHAR},
            </if>
            <if test="order.audit_man != null">
                audit_man=#{order.audit_man,jdbcType=VARCHAR},
            </if>
            <if test="order.audit_datetime != null">
                audit_datetime=#{order.audit_datetime,jdbcType=TIMESTAMP},
            </if>
            <if test="order.is_end != null">
                is_end=#{order.is_end,jdbcType=INTEGER},
            </if>
            <if test="order.driver_phone != null">
                driver_phone=#{order.driver_phone,jdbcType=VARCHAR},
            </if>
            <if test="order.driver_id != null">
                driver_id=#{order.driver_id,jdbcType=VARCHAR},
            </if>
            <if test="order.customer_id != null">
                customer_id=#{order.customer_id,jdbcType=INTEGER},
            </if>
            <if test="order.order_status != null">
                order_status=#{order.order_status,jdbcType=INTEGER},
            </if>
            <if test="order.in_customer_time != null">
                in_customer_time=  #{in_customer_time,jdbcType=TIMESTAMP},
            </if>
        </set>
        WHERE 1 = 1
        <if test="ids!=null">
            AND id
            <foreach close=")" collection="ids" item="listItem" open="in (" separator=",">
              #{listItem}
            </foreach>
        </if>
    </update>

    <insert id="insertByPickgoods" parameterType="com.xiaoyuan.model.ErpPickgoods" useGeneratedKeys="true" keyProperty="id">
        insert into tl_erp_pickgoods
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="user_id != null">
                user_id,
            </if>
            <if test="supplier_id != null">
                supplier_id,
            </if>
            <if test="car_order_sn != null">
                car_order_sn,
            </if>
            <if test="pickgoods_out != null">
                pickgoods_out,
            </if>
            <if test="pickgoods_num != null">
                pickgoods_num,
            </if>
            <if test="pickgoods_man != null">
                pickgoods_man,
            </if>
            <if test="pickgoods_date != null">
                pickgoods_date,
            </if>
            <if test="pickgoods_head != null">
                pickgoods_head,
            </if>
            <if test="pickgoods_car_sn != null">
                pickgoods_car_sn,
            </if>
            <if test="pickgoods_remark != null">
                pickgoods_remark,
            </if>
            <if test="pickgoods_sendcate != null">
                pickgoods_sendcate,
            </if>
            <if test="pickgoods_send_price != null">
                pickgoods_send_price,
            </if>
            <if test="pickgoods_send_company != null">
                pickgoods_send_company,
            </if>
            <if test="createtime != null">
                createtime,
            </if>
            <if test="updatetime != null">
                updatetime,
            </if>
            <if test="state != null">
                state,
            </if>
            <if test="status_ != null">
                status_,
            </if>
            <if test="goods_sn != null">
                goods_sn,
            </if>
            <if test="goods_cate != null">
                goods_cate,
            </if>
            <if test="goods_spec != null">
                goods_spec,
            </if>
            <if test="goods_name != null">
                goods_name,
            </if>
            <if test="audit != null">
                audit,
            </if>
            <if test="audittime != null">
                audittime,
            </if>
            <if test="order_cate != null">
                order_cate,
            </if>
            <if test="user_address != null">
                user_address,
            </if>
            <if test="supplier_spec != null">
                supplier_spec,
            </if>
            <if test="ingoods_price != null">
                ingoods_price,
            </if>
            <if test="ingoods_totalprice != null">
                ingoods_totalprice,
            </if>
            <if test="is_car_order != null">
                is_car_order,
            </if>
            <if test="is_return_goods != null">
                is_return_goods,
            </if>
            <if test="is_confirm_queue != null">
                is_confirm_queue,
            </if>
            <if test="confirm_queue_datetime != null">
                confirm_queue_datetime,
            </if>
            <if test="province_id != null">
                province_id,
            </if>
            <if test="area_id != null">
                area_id,
            </if>
            <if test="city_id != null">
                city_id,
            </if>
            <if test="province_txt != null">
                province_txt,
            </if>
            <if test="city_txt != null">
                city_txt,
            </if>
            <if test="area_txt != null">
                area_txt,
            </if>
            <if test="customer_name != null">
                customer_name,
            </if>
            <if test="audit_man != null">
                audit_man,
            </if>
            <if test="audit_datetime != null">
                audit_datetime,
            </if>
            <if test="is_end != null">
                is_end,
            </if>
            <if test="driver_phone != null">
                driver_phone,
            </if>
            <if test="driver_id != null">
                driver_id,
            </if>
            <if test="customer_id != null">
                customer_id,
            </if>
            <if test="order_status != null">
                order_status,
            </if>
            <if test="accountId != null">
                account_id,
            </if>
            <if test="in_customer_time != null">
                in_customer_time,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="user_id != null">
                #{user_id,jdbcType=INTEGER},
            </if>
            <if test="supplier_id != null">
                #{supplier_id,jdbcType=INTEGER},
            </if>
            <if test="car_order_sn != null">
                #{car_order_sn,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_out != null">
                #{pickgoods_out,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_num != null">
                #{pickgoods_num,jdbcType=DECIMAL},
            </if>
            <if test="pickgoods_man != null">
                #{pickgoods_man,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_date != null">
                #{pickgoods_date,jdbcType=TIMESTAMP},
            </if>
            <if test="pickgoods_head != null">
                #{pickgoods_head,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_car_sn != null">
                #{pickgoods_car_sn,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_remark != null">
                #{pickgoods_remark,jdbcType=VARCHAR},
            </if>
            <if test="pickgoods_sendcate != null">
                #{pickgoods_sendcate,jdbcType=INTEGER},
            </if>
            <if test="pickgoods_send_price != null">
                #{pickgoods_send_price,jdbcType=DECIMAL},
            </if>
            <if test="pickgoods_send_company != null">
                #{pickgoods_send_company,jdbcType=VARCHAR},
            </if>
            <if test="createtime != null">
                #{createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="updatetime != null">
                #{updatetime,jdbcType=TIMESTAMP},
            </if>
            <if test="state != null">
                #{state,jdbcType=INTEGER},
            </if>
            <if test="status_ != null">
                #{status_,jdbcType=INTEGER},
            </if>
            <if test="goods_sn != null">
                #{goods_sn,jdbcType=VARCHAR},
            </if>
            <if test="goods_cate != null">
                #{goods_cate,jdbcType=VARCHAR},
            </if>
            <if test="goods_spec != null">
                #{goods_spec,jdbcType=VARCHAR},
            </if>
            <if test="goods_name != null">
                #{goods_name,jdbcType=VARCHAR},
            </if>
            <if test="audit != null">
                #{audit,jdbcType=INTEGER},
            </if>
            <if test="audittime != null">
                #{audittime,jdbcType=TIMESTAMP},
            </if>
            <if test="order_cate != null">
                #{order_cate,jdbcType=VARCHAR},
            </if>
            <if test="user_address != null">
                #{user_address,jdbcType=VARCHAR},
            </if>
            <if test="supplier_spec != null">
                #{supplier_spec,jdbcType=VARCHAR},
            </if>
            <if test="ingoods_price != null">
                #{ingoods_price,jdbcType=DECIMAL},
            </if>
            <if test="ingoods_totalprice != null">
                #{ingoods_totalprice,jdbcType=DECIMAL},
            </if>
            <if test="is_car_order != null">
                #{is_car_order,jdbcType=INTEGER},
            </if>
            <if test="is_return_goods != null">
                #{is_return_goods,jdbcType=INTEGER},
            </if>
            <if test="is_confirm_queue != null">
                #{is_confirm_queue,jdbcType=INTEGER},
            </if>
            <if test="confirm_queue_datetime != null">
                #{confirm_queue_datetime,jdbcType=TIMESTAMP},
            </if>
            <if test="province_id != null">
                #{province_id,jdbcType=INTEGER},
            </if>
            <if test="area_id != null">
                #{area_id,jdbcType=INTEGER},
            </if>
            <if test="city_id != null">
                #{city_id,jdbcType=INTEGER},
            </if>
            <if test="province_txt != null">
                #{province_txt,jdbcType=VARCHAR},
            </if>
            <if test="city_txt != null">
                #{city_txt,jdbcType=VARCHAR},
            </if>
            <if test="area_txt != null">
                #{area_txt,jdbcType=VARCHAR},
            </if>
            <if test="customer_name != null">
                #{customer_name,jdbcType=VARCHAR},
            </if>
            <if test="audit_man != null">
                #{audit_man,jdbcType=VARCHAR},
            </if>
            <if test="audit_datetime != null">
                #{audit_datetime,jdbcType=TIMESTAMP},
            </if>
            <if test="is_end != null">
                #{is_end,jdbcType=INTEGER},
            </if>
            <if test="driver_phone != null">
                #{driver_phone,jdbcType=VARCHAR},
            </if>
            <if test="driver_id != null">
                #{driver_id,jdbcType=INTEGER},
            </if>
            <if test="customer_id != null">
                #{customer_id,jdbcType=INTEGER},
            </if>
            <if test="order_status != null">
                #{order_status,jdbcType=INTEGER},
            </if>
            <if test="accountId != null">
                #{accountId,jdbcType=INTEGER},
            </if>
            <if test="in_customer_time != null">
                #{in_customer_time,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>

    <select id="selectIsConfirmQueueByTime" resultType="java.lang.Integer">
        SELECT COUNT(PICKGOODS.ID)
        FROM tl_erp_pickgoods AS PICKGOODS
        LEFT JOIN tl_erp_driver AS DRIVER ON DRIVER.id = PICKGOODS.driver_id
        WHERE 1 = 1 and PICKGOODS.order_status = 0 AND PICKGOODS.order_cate = '销售'
        AND PICKGOODS.confirm_queue_device = 0 and PICKGOODS.is_confirm_queue = 0
        AND PICKGOODS.is_end = 0
        <if test="nowTime!=null and nowTime!= ''">
            AND confirm_queue_datetime between date_add(#{nowTime},INTERVAL - 1 minute) and #{nowTime}
        </if>
        <if test="driverId!=null">
            and driver_id = #{driverId}
        </if>
        <if test="userId!=null">
            and DRIVER.user_id = #{userId}
        </if>

    </select>

    <select id="sumCurrentPickGoodsNum" resultType="java.math.BigDecimal">
        SELECT IFNULL(SUM(pickgoods_num),0.00) as total from tl_erp_pickgoods
        where 1 = 1 AND createtime between DATE_FORMAT(NOW(), '%Y-%m-%d 00:00:00') and  DATE_FORMAT(NOW(), '%Y-%m-%d 23:59:59') AND user_id = #{userId}
    </select>
    <select id="countIsConfirmQueueNum" resultType="java.lang.Integer">
        SELECT COUNT(PICKGOODS.ID)
        FROM tl_erp_pickgoods AS PICKGOODS
        LEFT JOIN tl_erp_driver AS DRIVER ON DRIVER.id = PICKGOODS.driver_id
        WHERE 1 = 1 AND (PICKGOODS.confirm_queue_device != 0 OR PICKGOODS.is_confirm_queue != 0 )
        AND PICKGOODS.is_end = 0 and PICKGOODS.order_status = 0 AND PICKGOODS.order_cate = '销售'
        <if test="userId!=null">
            and DRIVER.user_id = #{userId}
        </if>
    </select>
</mapper>